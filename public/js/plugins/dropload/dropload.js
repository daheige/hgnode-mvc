"use strict";!function(o){function t(o){o.touches||(o.touches=o.originalEvent.touches)}function s(o){o.opts.scrollArea==e?o._scrollContentHeight=l.height():o._scrollContentHeight=o.$element[0].scrollHeight}function n(o,t){o.css({"-webkit-transition":"all "+t+"ms",transition:"all "+t+"ms"})}var e=window,i=document,d=o(e),l=o(i);o.fn.dropload=function(o){return new c(this,o)};var c=function(t,s){this.$element=o(t),this.upInsertDOM=!1,this.loading=!1,this.isLockUp=!1,this.isLockDown=!1,this.isData=!0,this._scrollTop=0,this.init(s)};c.prototype.init=function(s){function c(){a.direction="up",a.$domDown.html(a.opts.domDown.domLoad),a.loading=!0,a.opts.loadDownFn(a)}var a=this;a.opts=o.extend(!0,{},{scrollArea:a.$element,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-refresh">↓下拉刷新</div>',domUpdate:'<div class="dropload-update">↑释放更新</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>'},domDown:{domClass:"dropload-down",domRefresh:'<div class="dropload-refresh">↑上拉加载更多</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>',domNoData:'<div class="dropload-noData">暂无更多数据</div>'},distance:50,threshold:"50",loadUpFn:"",loadDownFn:""},s),""!=a.opts.loadDownFn&&(a.$element.append('<div class="'+a.opts.domDown.domClass+'">'+a.opts.domDown.domRefresh+"</div>"),a.$domDown=o("."+a.opts.domDown.domClass)),a.opts.scrollArea==e?(a.$scrollArea=d,a._scrollContentHeight=l.height(),a._scrollWindowHeight=i.documentElement.clientHeight):(a.$scrollArea=a.opts.scrollArea,a._scrollContentHeight=a.$element[0].scrollHeight,a._scrollWindowHeight=a.$element.height()),a._scrollContentHeight<=a._scrollWindowHeight&&c(),d.on("resize",function(){a.opts.scrollArea==e?a._scrollWindowHeight=e.innerHeight:a._scrollWindowHeight=a.$element.height()}),a.$element.on("touchstart",function(o){a.loading||(t(o),function(o,t){t._startY=o.touches[0].pageY,t.touchScrollTop=t.$scrollArea.scrollTop()}(o,a))}),a.$element.on("touchmove",function(s){a.loading||(t(s),function(t,s){s._curY=t.touches[0].pageY,s._moveY=s._curY-s._startY,s._moveY>0?s.direction="down":s._moveY<0&&(s.direction="up");var e=Math.abs(s._moveY);""!=s.opts.loadUpFn&&s.touchScrollTop<=0&&"down"==s.direction&&!s.isLockUp&&(t.preventDefault(),s.$domUp=o("."+s.opts.domUp.domClass),s.upInsertDOM||(s.$element.prepend('<div class="'+s.opts.domUp.domClass+'"></div>'),s.upInsertDOM=!0),n(s.$domUp,0),e<=s.opts.distance?(s._offsetY=e,s.$domUp.html(s.opts.domUp.domRefresh)):e>s.opts.distance&&e<=2*s.opts.distance?(s._offsetY=s.opts.distance+.5*(e-s.opts.distance),s.$domUp.html(s.opts.domUp.domUpdate)):s._offsetY=s.opts.distance+.5*s.opts.distance+.2*(e-2*s.opts.distance),s.$domUp.css({height:s._offsetY}))}(s,a))}),a.$element.on("touchend",function(){a.loading||function(t){var s=Math.abs(t._moveY);""!=t.opts.loadUpFn&&t.touchScrollTop<=0&&"down"==t.direction&&!t.isLockUp&&(n(t.$domUp,300),s>t.opts.distance?(t.$domUp.css({height:t.$domUp.children().height()}),t.$domUp.html(t.opts.domUp.domLoad),t.loading=!0,t.opts.loadUpFn(t)):t.$domUp.css({height:"0"}).on("webkitTransitionEnd transitionend",function(){t.upInsertDOM=!1,o(this).remove()}),t._moveY=0)}(a)}),a.$scrollArea.on("scroll",function(){a._scrollTop=a.$scrollArea.scrollTop(),""===a.opts.threshold?a._threshold=Math.floor(1*a.$domDown.height()/3):a._threshold=a.opts.threshold,""!=a.opts.loadDownFn&&!a.loading&&!a.isLockDown&&a._scrollContentHeight-a._threshold<=a._scrollWindowHeight+a._scrollTop&&c()})},c.prototype.lock=function(o){void 0===o?"up"==this.direction?this.isLockDown=!0:"down"==this.direction?this.isLockUp=!0:(this.isLockUp=!0,this.isLockDown=!0):"up"==o?this.isLockUp=!0:"down"==o&&(this.isLockDown=!0)},c.prototype.unlock=function(){this.isLockUp=!1,this.isLockDown=!1},c.prototype.noData=function(){this.isData=!1},c.prototype.resetload=function(){var t=this;"down"==t.direction&&t.upInsertDOM?t.$domUp.css({height:"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){t.loading=!1,t.upInsertDOM=!1,o(this).remove(),s(t)}):"up"==t.direction&&(t.loading=!1,t.isData?(t.$domDown.html(t.opts.domDown.domRefresh),s(t)):t.$domDown.html(t.opts.domDown.domNoData))}}(window.jQuery);